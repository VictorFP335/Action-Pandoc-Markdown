name: Gerar Slides PDF

on:
  push:
    paths:
      - "docs/**/*.md"
      - "docs/**/*.yaml"
      - "docs/**/*.yml"
  pull_request:
    paths:
      - "docs/**/*.md"
      - "docs/**/*.yaml"
      - "docs/**/*.yml"
  workflow_dispatch:

jobs:
  build-slides:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout do código
        uses: actions/checkout@v4

      - name: Instalar Pandoc e LaTeX
        run: |
          sudo apt-get update
          sudo apt-get install -y pandoc \
            texlive-xetex \
            texlive-latex-extra \
            texlive-fonts-extra \
            texlive-science \
            texlive-pictures

      - name: Listar arquivos em docs (debug)
        run: |
          echo "Conteúdo de docs:"
          ls -la docs || true

      - name: Encontrar arquivo Markdown principal
        id: find_md
        run: |
          f=$(find docs -type f -name '*.md' | head -n 1 || true)
          if [ -z "$f" ]; then
            echo "::error ::Nenhum arquivo Markdown encontrado em docs. Verifique o caminho ou adicione um .md."
            exit 1
          fi
          echo "Arquivo selecionado: $f"
          echo "markdown_file=$f" >> $GITHUB_OUTPUT

      - name: Converter Markdown em PDF
        run: |
          pandoc "${{ steps.find_md.outputs.markdown_file }}" \
            -o docs/presentation.pdf \
            --slide-level=2 \
            --pdf-engine=xelatex \
            --from markdown

      - name: Fazer upload do PDF como artefato
        uses: actions/upload-artifact@v4
        with:
          name: slides-pdf
          path: docs/presentation.pdf
          retention-days: 30

      - name: Exibir URL do PDF
        run: |
          echo ""
          echo "✅ Slides gerados com sucesso!"
          echo "📄 Você pode acessá-los em:"
          echo "🌐 https://VictorFP335.github.io/exercicio-pandoc-slides/slides.pdf"
          echo ""
